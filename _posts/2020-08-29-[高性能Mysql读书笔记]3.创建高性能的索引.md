---
layout: post
title:  "[高性能Mysql读书笔记]3.创建高性能的索引"
date:   2020-08-29 11:44
tags: Mysql
color: rgb(255,215,0)
cover: '../coverimages/mysql.jpg'
---

## 3 创建高性能的索引

> 索引是一种存储引擎为了快速找到数据的一种数据结构，这是索引的基本作用，在数据量较小的时候，不恰当的索引对数据影响可能还比较小，但当数据量逐渐增大时，性能则会急剧下降

## 3.1索引基础

>在Mysql中，存储引擎索引的方式类似于书本的索引，现在索引中找到页码，然后再去页码中找到内容，Mysql则是现在索引中找到对应值，然后根据匹配的索引找到对应的数据行。例如要执行下面的查询
``` sql
select name from student where stu_id = 5;
```

> 如果在stu_id上面建有索引，则Mysql将使用该索引找到stu_id=5的行（具体机制后面解释），也就是说，Mysql先在索引上按照值进行查找，然后返回所有包含该值的数据行

> 索引可以包含一个列或者多个列的值，索引的顺序也是非常重要的，创建一个包含两个列的索引和创建两个包含一个列的索引是大大不同的

## 3.1.1 索引的类型

> 索引是一种数据结构，但它也有很多种类型，可以为不同的场景中提供更好的性能。在Mysql中，索引的实现是在存储引擎层而不是服务层，所以索引的实现并没有统一的标准；不同存储引擎的索引的工作方式不一样。

**B-Tree索引**

> 存储引擎以不同的方式来使用B-Tree引擎，性能也各有不同，各有优劣。例如，MyISAM使用前缀压缩使得索引更小，而InnoDB则按照数据的原数据进行存储，MyISAM通过数据的物理位置引用被索引的行，而InnoDB则通过主键来引用被索引的行

>B—Tree一般又分为B+Tree和B—Tree

>B树和B+树的主要区别在于，B+树叶子节点存储真实的数据，非叶子节点存储键值，而且一般每个节点的大小都是4kb的整数倍，例用“预加载”技术，便于磁盘对数据的查找，大致如下图，Mysql中默认页大小为16kb，InnoDB用的就是B+Tree，下图为主键索引

![enter description here](https://raw.githubusercontent.com/LazystudentCH/blogImage/master/2020/9/1/[高性能Mysql读书笔记]3.创建高性能的索引/1598972722074.png)

> 尽量使用数字作为主键，便于自增，便于存储，便于排序。根据主键创建的索引又叫做主键索引，如果没有主键，会选择一列唯一索引作为主键，如果还没有，会创建一个隐藏列，叫rowID作为主键。

> 其他一个列或者多个列创建的索引叫做辅助索引，辅助索引叶子节点不存储实际数据，而是存储主键，再根据主键找所需的数据行

> 上文提到的索引对如下类型的查询有效
> * 全职匹配
	> 全值匹配指的是和索引中的所有列进行匹配，例如有abc三个字段一起的索引，对abc三列进行查询。
> * 匹配最左前缀
	> 最左前缀指的是只用索引的第一列
> * 匹配最前列
	> 可以匹配某一列值的开头，比如索引abc，对a,b进行查询，可以用到前两列
> * 匹配范围值
	> 可以使用索引的某一列去查找某个范围，例如索引abc，查询 a > 1，可以用到索引的第一列
> * 精确匹配某一列并范围匹配另一列
> * 只访问索引的查询
	> 这种也被称作“覆盖索引”，后续作详细说明

**B-Tree索引的限制**
>* 如果不是按照索引的最左列开始寻找，则无法使用索引。例如abc三列简历索引，无法单独查找b,c
>* 不能跳过中间的列
>* 如果查询中有某个列的范围查询，则后面的列无法使用索引优化，因为索引依靠排序。
>* like 模糊查询如果以 %开头 无法使用索引，理由同上
>* 出现隐式转换，例如字符串转成数字
>* or 关键字左边和右边没有同时使用索引
>* 在索引字段上使用not，<>，!=。不等于操作符是永远不会用到索引的，因此对它的处理只会产生全表扫描
>* 在索引字段上使用函数，因为索引依赖排序，使用函数产生的结果不一定和原来顺序一样

