---
layout: post
title:  "[高性能Mysql读书笔记]2.schema与数据类型优化"
date:   2020-08-23 13:07
tags: Mysql
color: rgb(255,215,0)
cover: '../coverimages/mysql.jpg'
---

##  2.1选择优化的数据类型

> mysql中的数据类型非常多，选择正确的数据类型对获得高性能至关重要，不管存储哪种类型的数据，下面几个简单的原则都有利于做出更好的选择
> * 更小的通常更好
	> 一般情况下，应该尽量使用可以正确存储数据的最小类型，更小的数据类型通常更快(例如tiny int)，因为他们占用更少的磁盘，内存和CPU缓存，并且处理的时候，CPU需要的周期也更少，但是需要没有低估存储值的范围
> * 简单就好
	> 简单的数据类型通常需要更少的CPU周期，例如，操作int的代价比string类型更低，因为字符集的排序规则比整型更加复杂。这里有两个例子，一个是应该使用Mysql的内建类型，例如date datetime timestamp来存储时间和日期而不是字符串，另外一个是应该用整形来存储IP地址
> * 尽量避免Null
	> 如果查询中包含Null的列，对Mysql来说更难优化，因为可为Null的列使得索引，索引统计和值比较都更为复杂，可为Null还需要花费更多的存储空间，在Mysql中也需要特殊处理，每个索引需要记录一个额外的字节，但是通常把Null变为不可为Null对性能的提升较小

> 下一步是选择具体的数据类型，很多Mysql的数据类型可以存储相同的类型和数据，只是存储的长度和范围不一样、允许的精度不同，或者需要不同的物理空间。例如： DATETIME和TIMESTAMP列都可以存储相同类型的数据，时间和日期，精确到秒，但是TIMESTAMP只需要DATETIME一半的存储空间，并且拥有自动更新的能力，根据时区自动变化，另一方面，TIMESTAMP允许的时间范围要比DATETIME小得多，有时候它的特殊能力会成为障碍

## 2.2 整数类型
> 如果存储整型，可以用tinyint smallint mediumint int bigint 分别使用8,16,24,32,64来存储，整型大多都用unsiged选项，表示不允许负值，而这可以使得正数的范围翻倍，有符号和无符号使用相同的存储空间，并具有相同的性能

> Mysql可以为整数类型指定宽度，例如INT(11)，这里对大多数应用都是没有意义的，它不会限制数据的合法范围，只是表示可以显示的字符个数，对于存储和计算来说int(1)和int(20)是一样的。

## 2.3 实数类型
> 实数是带有小数部分的数字，float使用4个字节，double使用8个字节，和整数类型一样，只能选择存储类型，Mysql内部使用double作为内部浮点的计算类型

## 2.4 字符串类型
> Mysql支持多种字符串类型，每种类型还有很多变种

## 2.4.1 VARCHAR
> VARCHAR和CHAR是两种最主要的字符串类型。比较难解释这两种值是如何在磁盘和内存中存储的，因为各个存储引擎的实现不同，下文将主要以InnoDB和MyISAM来说明

>VARCHAR类型用于存储可变长字符串，是最常见的数据类型，它比定长类型更加节省空间，因为它仅仅使用必要的空间，但是有一种情况例外，就是ROW_FORMAT=FIXED的话，就会使得每一行都使用定长存储，这会很浪费空间

>VARCHAR需要用一个或者两个字节来存储字符串长度，如果字符串的长度小于等于255，则需要一个字节，否则需要两个字节，VARCHAR（255）一个字节存储长度，因为最大长度为255

>VARCHAR节省了存储空间，所以对性能也有帮助，但是由于行是变长的，在update的时候由于可能使行变得更长，这就导致需要做额外的工作，如果一个行占用的空间增大，并且在页内没有多余的空间来存储，这种情况下，MyISAM和InnoDB处理方式是不一样的，MyISAM会将行拆成不同的片段来存储，则需要分裂页来使得行可以放进页内

> VARCHAR会保留末尾的空格

![enter description here](https://raw.githubusercontent.com/LazystudentCH/blogImage/master/2020/8/24/[高性能Mysql读书笔记]2.schema与数据类型优化/1598280167799.png)

## 2.4.2 CHAR类型
> CHAR类型是定长的，Mysql总是根据定义的字符串长度来分配足够的空间，当存储CHAR的时候,Mysql会删除末尾的所有空格，CHAR非常适合长度相近的字符串，若长度不足，会采用空格来填充。

## 2.4.3 BLOB和TEXT类型
>

